### 项目介绍

基于Spring Boot+Redis+COS+AI+WebSocket 的企业级智能协同云图库平台。

分为公共图库、私有图库和团队共享图库三大模块。用户可在平台公开上传和检索图片;管理员可以上传、审核和管理分析图片。个人用户可将图片上传至私有空间进行批量管理、多维检索、编辑和分析;企业可开通团队空间并邀请成员,共享和实时协同编辑图片。

### 项目架构

![项目架构.webp](docs/picture/%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84.webp)

### 主要工作

1. 基于自研的Spring Boot 项目模板+MyBatis Plus+MyBatis X插件构建核心业务,实现用户、图片、空间等实体表的CRUD操作。

2. 使用Spring Initializr 初始化项目,实现MyBatis Plus、Hutool、Knife4j接口文档、Lombok 等主流依赖整合。
3. 引入MyBatis Plus 实现 Mapper自动扫描,并基于其BaseMapper+自定义分页拦截器快速实现CRUD操作,减少了
   大量样板代码。
4. 统一异常管理:封装了自定义异常类及统一错误码枚举类,并基于@RestControllerAdvice 注解开发全局异常处理
   器,提升了系统的稳定性。
5. 统一响应封装:自定义响应封装类和返回成功/失败响应的工具类,实现了标准化的接口响应数据格式,便于前后端
   交互。
6. 全局跨域配置:基于WebMvcConfigurer实现了全局CORS配置类,配置可信源,解决了前后端跨域请求问题。
7. 精度丢失解决:自定义Jackson配置类,通过ObjectMapper配置Long类型序列化为字符串,解决前端因JS精度限
   制导致的长整型数据精度丢失问题,确保前后端数据一致。
8. 通过MyBatis Plus的LambdaQueryWrapper和SqlRunner 构造动态SQL查询,简化了操作数据库的编码。
9. 库表设计:根据业务设计用户、图片、空间、空间成员表,其中图片标签采用JSON数组存储,便于维护;并通过给空间成员关联表添加联合索引来提升检索性能。
10. 使用Knife4j自动生成接口文档,并基于ApiOperation注解编写接口注释,减少了人工维护文档的工作量,提高了接口可读性。
11. 用户注册:使用MD5+盐值加密策略对用户密码进行加密存储,防止明文密码泄露风险。
12. 用户登录:通过Redis整合 Spring Session分布式保存用户登录态,实现了跨服务器的用户识别。
13. 权限管理:基于自定义权限校验注解和Spring AOP环绕切面,实现了统一的权限校验,区分用户和管理员。
14. 图片存管:基于COS对象存储SDK封装了通用文件上传下载服务,并基于数据万象服务自动解析图片信息(包括宽
    高、格式、大小等),便于检索。
15. 图片审核:设计分级审核策略,管理员上传图片自动通过审核,并自动记录审核时间与审核人id,确保可审计追溯。
    风险。
16. URL传图:使用Hutool 请求URL来下载图片,并在下载前通过Head 请求校验URL,有效降低带宽消耗与数据异常
17. 运用模板方法 设计模式统一封装本地图片和URL图片上传的流程,如校验、下载、上传和资源释放,复用代码并提
    高可维护性。
18. 批量导图:利用Jsoup实现Bing网页图片抓取,并通过CompletableFuture实现批量上传和入库,性能提升300%
19. 查询优化:为提高主页热门图片的查询性能,采用Redis+Caffeine 构建 多级缓存,接口响应耗时降低400%,并通 过随机过期时间降低缓存雪崩风险。
20. 加载优化:利用数据万象,在上传前对大文件进行Webp转码压缩和缩略图生成,再配合CDN,大幅提高页面加载速度并节约成本。
21. 存储优化:利用对象存储的数据沉降功能,对30天未访问图片自动降频存储,并开发失效图片定时清理功能,大幅节约存储成本。
22. 上传优化:为提高大文件上传效率,设计实现了基于MD5校验的图片秒传 功能,并使用COS SDK实现大文件分片上传和断点续传。
23. 空间创建:基于 分段锁+TransactionTemplate 编程式事务实现了空间创建服务,限制每个用户最多创建一个私有空 间。
24. 空间额度:通过 TransactionTemplate编程式事务,确保上传图片到空间时会增加存储额度的占用;并通过限流和预校验机制防止存储额度超限。
25. 图片搜索:基于MyBatis Plus封装了将对象转换为SQL查询的通用方法,支持按关键词、标签、分类、时间范围等
    多维度组合搜索。
26. 以图搜图:通过分析请求获取到百度以图搜图API,利用Jsoup和HttpClient调用API,并运用门面模式组合API调
    用来获取图片列表,便于客户端使用。
27. 颜色搜图:使用数据万象提取图片主色调并存储到数据库,搜索时通过欧氏距离计算颜色相似度并通过 Stream API
    进行排序。
28. 批量编辑:通过Transactional 事务管理确保批量编辑图片的原子性;并利用ThreadPoolExecutor+数据库批处理进
    一步优化了批处理性能。
29. AI扩图:基于阿里云百炼大模型封装AI绘图服务,提供创建与查询任务的API,采用异步任务轮询处理进度,并统一错误码以提升稳定性。
30. 30.空间分析:运用group by实现数据的聚合统计,并通过MyBatis Plus的selectObjs方法按需选择字段,提高查询性 能并节约内存占用。
31. 成员管理:设计space_user关联表保存团队空间成员及角色信息,使用唯一联合索引防止成员重复加入,同时提升 查询性能。
32. 运用@Lazy注解,解决了空间服务和空间成员服务互相引用导致的循环依赖问题。
33. 权限管理:基于Sa-Token的Kit模式实现了多账号体系的RBAC权限控制,通过从请求上下文中获取参数实现了统一的权限校验逻辑,并运用注解合并简化了鉴权注解的使用,轻松实现方法级别的权限校验。
34. 数据分表:使用ShardingSphere 自定义分表算法实现了团队空间图片的动态分表,提高了查询效率。并且为了通过框架内置的校验规则,手动维护可用分表节点。
35. 协作编辑:基于WebSocket+事件驱动设计 实现多人协作编辑图片功能,自定义握手拦截器确保权限校验通过后才
    能连接,并通过“编辑锁”机制,避免编辑冲突。
36. 协作优化:基于Disruptor无锁队列 实现了WebSocket消息的异步化处理,显著提升系统吞吐量;并结合@PreDestroy
    注解实现优雅停机,防止编辑操作丢失。
37. 架构升级:随着项目代码量增大,引入领域驱动设计DDD,将业务逻辑按子域拆分,优化了代码结构与可扩展性。
38. 部署上线:通过宝塔 Linux的Java项目管理器部署jar包,并通过Nginx配置反向代理解决跨域问题。


